(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{103:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return i})),n.d(t,"metadata",(function(){return c})),n.d(t,"toc",(function(){return s})),n.d(t,"default",(function(){return b}));var r=n(3),a=n(7),o=(n(0),n(113)),i={id:"network-monitoring",title:"Monitoring of network conditions",sidebar_label:"Network Monitoring",slug:"/design/network-monitoring",partners:["rwth","uos"]},c={unversionedId:"design/network-monitoring",id:"design/network-monitoring",isDocsHomePage:!1,title:"Monitoring of network conditions",description:"Facts",source:"@site/docs/design/network-monitoring.md",slug:"/design/network-monitoring",permalink:"/docs/design/network-monitoring",editUrl:"https://github.com/ERIGrid2/riasc/edit/master/docs/design/network-monitoring.md",version:"current",sidebar_label:"Network Monitoring",sidebar:"docs",previous:{title:"Network emulation (netem) CNI-plugin for Kubernetes",permalink:"/docs/design/network-emulation"},next:{title:"PSAL Code Generation",permalink:"/docs/design/code-generation"}},s=[{value:"Collected Metrics",id:"collected-metrics",children:[]}],l={toc:s};function b(e){var t=e.components,n=Object(a.a)(e,["components"]);return Object(o.b)("wrapper",Object(r.a)({},l,n,{components:t,mdxType:"MDXLayout"}),Object(o.b)("h1",{id:"facts"},"Facts"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("strong",{parentName:"li"},"Source Code:")," ",Object(o.b)("a",{parentName:"li",href:"https://github.com/ERIGrid2/k8s-netmon"},"https://github.com/ERIGrid2/k8s-netmon")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("strong",{parentName:"li"},"Helm Chart:")," ",Object(o.b)("a",{parentName:"li",href:"https://github.com/ERIGrid2/charts/tree/master/charts/flent"},"https://github.com/ERIGrid2/charts/tree/master/charts/flent")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("strong",{parentName:"li"},"State:")," to be implemented")),Object(o.b)("h1",{id:"introduction"},"Introduction"),Object(o.b)("p",null,"The ",Object(o.b)("em",{parentName:"p"},"k8s-netmon")," component periodically performs network tests to measure letency and bandwidth between each and every node in the RIasC cloud.\nThe gathered measurements are then used to construct graph in wich the vertices represent the nodes and edges are annotated with the measurements."),Object(o.b)("h2",{id:"collected-metrics"},"Collected Metrics"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"Connectivity"),Object(o.b)("li",{parentName:"ul"},"Latency"),Object(o.b)("li",{parentName:"ul"},"Bandwidth")),Object(o.b)("h1",{id:"employed-technologies"},"Employed technologies"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",{parentName:"li",href:"https://flent.org/"},"Flent")),Object(o.b)("li",{parentName:"ul"},"Kubernetes:",Object(o.b)("ul",{parentName:"li"},Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",{parentName:"li",href:"https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/"},"Custom Resources"))))),Object(o.b)("h1",{id:"architecture"},"Architecture"),Object(o.b)("p",null,Object(o.b)("inlineCode",{parentName:"p"},"k8s-netmon")," runs a Kubernetes controller which watches ",Object(o.b)("em",{parentName:"p"},"TestSchedule")," custom resources (CR)s.\nBased on ",Object(o.b)("em",{parentName:"p"},"TestSchedules")," CRs the controller will spawn ",Object(o.b)("em",{parentName:"p"},"DaemonSets")," to execute individual test runs between a pair of nodes.\nThe ",Object(o.b)("inlineCode",{parentName:"p"},"k8s-netmon")," controller will take care that ",Object(o.b)("em",{parentName:"p"},"TestSchedules")," are not executed simultaneously to avoid interference between the tests."),Object(o.b)("p",null,"The actual network tests are performed by ",Object(o.b)("a",{parentName:"p",href:"https://flent.org/"},"Flent"),", the Flexible network tester.\nThe ",Object(o.b)("inlineCode",{parentName:"p"},"k8s-netmon")," controller spawns pairs of Flent pods on different nodes within the cluster.\nThese pods will execute the Flent container image. One of them will act as a server while the other acts as the client.\nThe lifetime of these pods is short. They exist only for the duration of the test.\nFlent stores its results in archives which will be uploaded to a S3 object storage which they can be downloaded for subsequent analysis."),Object(o.b)("p",null,"The user should be supported in analysis of the collected data by a Python package which downloads the collected test results from the S3 object storage.\nThis Python package can also directly unpack and load the test results using appropriate packages like Pandas and perform visuzations with matplotlib."),Object(o.b)("p",null,"In addition, most recent measurments (e.g. ICMP ping RTT) can be stored in a Promtheus time-series database for monitoring.\nA dedicated Grafana instance is deployed in the cluster itself and can then be used to visualize the collected metrics."),Object(o.b)("p",null,"A dedicated Python program ",Object(o.b)("inlineCode",{parentName:"p"},"k8s-netmon-graph")," is used to retrieve the measurements from Promtheus and converts them into several different graph represenations for further processing:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"Graphviz Dot file"),Object(o.b)("li",{parentName:"ul"},"Rendered SVG graph"),Object(o.b)("li",{parentName:"ul"},"GraphML",Object(o.b)("sup",{parentName:"li",id:"fnref-3"},Object(o.b)("a",{parentName:"sup",href:"#fn-3",className:"footnote-ref"},"3")))),Object(o.b)("p",null,"For this purpose ",Object(o.b)("inlineCode",{parentName:"p"},"k8s-netmon-graph")," implements a simple HTTP API.\nThe rendered version of the graph is also embedded as an SVG graphic into the Grafana dashboard."),Object(o.b)("p",null,"For precise one-way delay measurements the accuracy of the system clocks is essential.\nTo increase the accuracy of the clocks, a dedicated component "),Object(o.b)("h1",{id:"implementation-details"},"Implementation details"),Object(o.b)("h1",{id:"further-reading"},"Further reading"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},Object(o.b)("a",{parentName:"p",href:"https://flent.org/"},"Flent"))),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},Object(o.b)("a",{parentName:"p",href:"https://github.com/simonswine/kube-latency"},"https://github.com/simonswine/kube-latency"))),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},Object(o.b)("a",{parentName:"p",href:"https://medium.com/flant-com/ping-monitoring-between-kubernetes-nodes-11e815f4eff1"},"https://medium.com/flant-com/ping-monitoring-between-kubernetes-nodes-11e815f4eff1"))),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},Object(o.b)("a",{parentName:"p",href:"https://github.com/redlab-i/pps-tools"},"https://github.com/redlab-i/pps-tools"))),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},Object(o.b)("a",{parentName:"p",href:"https://kubernetes.io/docs/concepts/workloads/controllers/daemonset/"},"Kubernetes DaemonSet")))),Object(o.b)("div",{className:"footnotes"},Object(o.b)("hr",{parentName:"div"}),Object(o.b)("ol",{parentName:"div"},Object(o.b)("li",{parentName:"ol",id:"fn-3"},Object(o.b)("a",{parentName:"li",href:"http://graphml.graphdrawing.org/about.html"},"http://graphml.graphdrawing.org/about.html"),Object(o.b)("a",{parentName:"li",href:"#fnref-3",className:"footnote-backref"},"\u21a9")))))}b.isMDXComponent=!0},113:function(e,t,n){"use strict";n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return d}));var r=n(0),a=n.n(r);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=a.a.createContext({}),b=function(e){var t=a.a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):c(c({},t),e)),n},p=function(e){var t=b(e.components);return a.a.createElement(l.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.a.createElement(a.a.Fragment,{},t)}},u=a.a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,i=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),p=b(n),u=r,d=p["".concat(i,".").concat(u)]||p[u]||m[u]||o;return n?a.a.createElement(d,c(c({ref:t},l),{},{components:n})):a.a.createElement(d,c({ref:t},l))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=u;var c={};for(var s in t)hasOwnProperty.call(t,s)&&(c[s]=t[s]);c.originalType=e,c.mdxType="string"==typeof e?e:r,i[1]=c;for(var l=2;l<o;l++)i[l]=n[l];return a.a.createElement.apply(null,i)}return a.a.createElement.apply(null,n)}u.displayName="MDXCreateElement"}}]);