"use strict";(self.webpackChunkriasc=self.webpackChunkriasc||[]).push([[6860],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return h}});var r=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=r.createContext({}),c=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=c(e.components);return r.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),d=c(n),h=a,m=d["".concat(s,".").concat(h)]||d[h]||u[h]||i;return n?r.createElement(m,o(o({ref:t},p),{},{components:n})):r.createElement(m,o({ref:t},p))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,o=new Array(i);o[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,o[1]=l;for(var c=2;c<i;c++)o[c]=n[c];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},64943:function(e,t,n){n.r(t),n.d(t,{assets:function(){return p},contentTitle:function(){return s},default:function(){return h},frontMatter:function(){return l},metadata:function(){return c},toc:function(){return u}});var r=n(87462),a=n(63366),i=(n(67294),n(3905)),o=["components"],l={id:"ip-overlay",title:"Transparent IP Overlay Network",sidebar_label:"Overlay Network",sidebar_position:2,slug:"/design/ip-overlay",partners:["rwth"]},s=void 0,c={unversionedId:"design/ip-overlay",id:"design/ip-overlay",title:"Transparent IP Overlay Network",description:"Facts",source:"@site/docs/design/ip-overlay.md",sourceDirName:"design",slug:"/design/ip-overlay",permalink:"/riasc/docs/design/ip-overlay",editUrl:"https://github.com/ERIGrid2/riasc/edit/master/docs/design/ip-overlay.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{id:"ip-overlay",title:"Transparent IP Overlay Network",sidebar_label:"Overlay Network",sidebar_position:2,slug:"/design/ip-overlay",partners:["rwth"]},sidebar:"docs",previous:{title:"Provisioning",permalink:"/riasc/docs/design/provisioning"},next:{title:"IP-Gateway/NAT",permalink:"/riasc/docs/design/ip-gateway"}},p={},u=[{value:"Facts",id:"facts",level:2},{value:"Introduction",id:"introduction",level:2},{value:"Employed technologies",id:"employed-technologies",level:2},{value:"Architecture",id:"architecture",level:2},{value:"Implementation details",id:"implementation-details",level:2},{value:"NAT-2-NAT hole punching",id:"nat-2-nat-hole-punching",level:3},{value:"STUN/TURN gateways for UDP-blocked corporate environments",id:"stunturn-gateways-for-udp-blocked-corporate-environments",level:3},{value:"Further Reading",id:"further-reading",level:2}],d={toc:u};function h(e){var t=e.components,n=(0,a.Z)(e,o);return(0,i.kt)("wrapper",(0,r.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h2",{id:"facts"},"Facts"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Git Repo:")," ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/ERIGrid2/charts/tree/master/charts/kilo"},"https://github.com/ERIGrid2/charts/tree/master/charts/kilo")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"State:")," under implementation")),(0,i.kt)("h2",{id:"introduction"},"Introduction"),(0,i.kt)("p",null,"Unlike in traditional cloud deployments, the participating agent nodes are usually not residing in the same network.\nAs a consequence, direct communication between containers deployed on different agent nodes is not possible.\nTo solve this restriction a transparent overlay network is established between all agent and master nodes.\nThis overlay network employs Virtual Private Network (VPN) solutions to create a mesh of peer-to-peer connections between all nodes in the cloud.\nWithin this overlay network all deployed containers are assigned an IP from the cluster internal subnet (usually) ",(0,i.kt)("inlineCode",{parentName:"p"},"10.42.0.0/16"),").\nContainers can use these addresses (and also Kubernetes ClusterIPs) to communicate with each other even if they are deployed on different nodes in different sites."),(0,i.kt)("p",null,"As the overlay network establishes connectivity between all nodes.\nThe Kubernetes cluster networks can be used as on any other Kubernetes cluster.\nHowever, its important to note that the overlay network only establishes connectivity between IPs/containers within the cluster.\nConnecting devices and services outside the cluster (e.g. in a dedicated laboratory network) is not supported by the overlay network.\nFor this purpose a dedicated service, the ",(0,i.kt)("a",{parentName:"p",href:"/riasc/docs/design/ip-gateway"},"IP gateway")," is used."),(0,i.kt)("h2",{id:"employed-technologies"},"Employed technologies"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://www.wireguard.com/"},"Wireguard")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/squat/kilo"},"Kilo")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/ERIGrid2/wice"},"WICE"))),(0,i.kt)("h2",{id:"architecture"},"Architecture"),(0,i.kt)("p",null,"The IP overlay network is implemented by a tool named ",(0,i.kt)("em",{parentName:"p"},"Kilo"),".\nKilo is a multi-cloud network overlay built on WireGuard and designed for Kubernetes.\nIt deploys the ",(0,i.kt)("inlineCode",{parentName:"p"},"kg")," daemon as Kubernetes DaemonSet on each node in the RIasC cloud.\nThe ",(0,i.kt)("inlineCode",{parentName:"p"},"kg")," daemon completely automates the configuration of each VPN service by facilitating the exchange of keys and endpoints."),(0,i.kt)("p",null,"In addition another tool named ",(0,i.kt)("em",{parentName:"p"},"WICE")," is used for facilitating peer-to-peer connections via ",(0,i.kt)("em",{parentName:"p"},"Kilo"),"."),(0,i.kt)("h2",{id:"implementation-details"},"Implementation details"),(0,i.kt)("h3",{id:"nat-2-nat-hole-punching"},"NAT-2-NAT hole punching"),(0,i.kt)("p",null,"Kilo supports UDP hole-punching in scenarios where two endpoints are located behind a NAT-firewall."),(0,i.kt)("p",null,"See: ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/squat/kilo/pull/146"},"https://github.com/squat/kilo/pull/146")),(0,i.kt)("p",null,"In addition ",(0,i.kt)("em",{parentName:"p"},"WICE"),", facilitates NAT-2-NAT connections by using ",(0,i.kt)("em",{parentName:"p"},"Interactive Connectivity Establishment")," ",(0,i.kt)("a",{parentName:"p",href:"https://datatracker.ietf.org/doc/html/rfc8445"},"RFC8445"),"."),(0,i.kt)("h3",{id:"stunturn-gateways-for-udp-blocked-corporate-environments"},"STUN/TURN gateways for UDP-blocked corporate environments"),(0,i.kt)("p",null,"Currently Kilo will fail to establish VPN connection if the endpoint is located behind a symmetric NAT/firewall.\nTo workaround this issue, (Interactive Connectivity Establishment (",(0,i.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Interactive_Connectivity_Establishment"},"RFC8445"),") can be used."),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://wiretrustee.com/"},"Wiretrustee")," is a project implementing this feature.\nWork is ongoing to integrate this code into Kilo."),(0,i.kt)("p",null,"See: ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/squat/kilo/issues/189"},"https://github.com/squat/kilo/issues/189")),(0,i.kt)("h2",{id:"further-reading"},"Further Reading"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://www.jordanwhited.com/posts/wireguard-endpoint-discovery-nat-traversal/"},"Jordan Whited: WireGuard Endpoint Discovery and NAT Traversal using DNS-SD")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://tailscale.com/blog/how-nat-traversal-works/"},"David Anderson: How NAT traversal works, Tailscale")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://tailscale.com/"},"Tailscale")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://wiretrustee.com/"},"Wiretrustee"))))}h.isMDXComponent=!0}}]);