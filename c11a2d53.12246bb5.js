(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{112:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return h}));var r=n(0),a=n.n(r);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=a.a.createContext({}),p=function(e){var t=a.a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},u=function(e){var t=p(e.components);return a.a.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.a.createElement(a.a.Fragment,{},t)}},b=a.a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,o=e.parentName,l=c(e,["components","mdxType","originalType","parentName"]),u=p(n),b=r,h=u["".concat(o,".").concat(b)]||u[b]||d[b]||i;return n?a.a.createElement(h,s(s({ref:t},l),{},{components:n})):a.a.createElement(h,s({ref:t},l))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=b;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:r,o[1]=s;for(var l=2;l<i;l++)o[l]=n[l];return a.a.createElement.apply(null,o)}return a.a.createElement.apply(null,n)}b.displayName="MDXCreateElement"},98:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return o})),n.d(t,"metadata",(function(){return s})),n.d(t,"toc",(function(){return c})),n.d(t,"default",(function(){return p}));var r=n(3),a=n(7),i=(n(0),n(112)),o={id:"ip-overlay",title:"Transparent IP Overlay Network",sidebar_label:"Overlay Network",slug:"/design/ip-overlay",partners:["rwth"]},s={unversionedId:"design/ip-overlay",id:"design/ip-overlay",isDocsHomePage:!1,title:"Transparent IP Overlay Network",description:"Facts",source:"@site/docs/design/ip-overlay.md",slug:"/design/ip-overlay",permalink:"/riasc/docs/design/ip-overlay",editUrl:"https://github.com/ERIGrid2/riasc/edit/master/docs/design/ip-overlay.md",version:"current",sidebar_label:"Overlay Network",sidebar:"docs",previous:{title:"Further Reading",permalink:"/riasc/docs/further-reading"},next:{title:"IP-Gateway/NAT for cluster-external devices",permalink:"/riasc/docs/design/ip-gateway"}},c=[{value:"NAT-2-NAT hole punching",id:"nat-2-nat-hole-punching",children:[]},{value:"STUN/TURN gateways for UDP-blocked corporate environments",id:"stunturn-gateways-for-udp-blocked-corporate-environments",children:[]}],l={toc:c};function p(e){var t=e.components,n=Object(a.a)(e,["components"]);return Object(i.b)("wrapper",Object(r.a)({},l,n,{components:t,mdxType:"MDXLayout"}),Object(i.b)("h1",{id:"facts"},"Facts"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("strong",{parentName:"li"},"Git Repo:")," ",Object(i.b)("a",{parentName:"li",href:"https://github.com/ERIGrid2/charts/tree/master/charts/riasc"},"https://github.com/ERIGrid2/charts/tree/master/charts/riasc")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("strong",{parentName:"li"},"State:")," to be implemented")),Object(i.b)("h1",{id:"introduction"},"Introduction"),Object(i.b)("p",null,"Unlike in traditional cloud deployments, the participating agent nodes are usually not residing in the same network.\nAs a consequence, direct communication between containers deployed on different agent nodes is not possible.\nTo solve this restriction a transparent overlay network is established between all agend and master nodes.\nThis overlay network employs Virtual Private Network (VPN) solutions to create a mesh of peer-to-peer connections between all nodes in the cloud.\nWithin this overlay network all deployed containers are assigned an IP from the cluster internat subnet (usually) ",Object(i.b)("inlineCode",{parentName:"p"},"10.42.0.0/16"),").\nContainers can use these addresses (and also Kubernetes ClusterIPs) to communicate with each other even if they are deployed on different nodes in different sites."),Object(i.b)("p",null,"As the overlay network establishes connectivty between all nodes.\nThe Kubernetes cluster networks can be used as on any other Kubernetes cluster.\nHowever, its important to note that the overlay network only establishes connectivity between IPs/containers within the cluster.\nConnecting devices and services outside the cluster (e.g. in a dedicated laboratory network) is not supported by the overlay network.\nFor this purpose a dedicated component, the ",Object(i.b)("a",{parentName:"p",href:"/riasc/docs/design/ip-gateway"},"IP gateway")," is used."),Object(i.b)("h1",{id:"employed-technologies"},"Employed technologies"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"https://www.wireguard.com/"},"Wireguard")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"https://github.com/squat/kilo"},"Kilo"))),Object(i.b)("h1",{id:"architecture"},"Architecture"),Object(i.b)("p",null,"The IP overlay network is implemented by a tool named ",Object(i.b)("em",{parentName:"p"},"Kilo"),".\nKilo is a multi-cloud network overlay built on WireGuard and designed for Kubernetes.\nIt deploys the ",Object(i.b)("inlineCode",{parentName:"p"},"kg")," daemon as Kubernetes DaemonSet on each node in the RIasC cloud.\nThe ",Object(i.b)("inlineCode",{parentName:"p"},"kg")," daemon completely automates the configuration of each VPN service by facilitating the exchange of keys and endpoints."),Object(i.b)("h1",{id:"implementation-details"},"Implementation details"),Object(i.b)("h2",{id:"nat-2-nat-hole-punching"},"NAT-2-NAT hole punching"),Object(i.b)("p",null,"Kilo supports UDP hole-punching in scenarios where two endpoints are located behind a NAT-firewall."),Object(i.b)("p",null,"See: ",Object(i.b)("a",{parentName:"p",href:"https://github.com/squat/kilo/pull/146"},"https://github.com/squat/kilo/pull/146")),Object(i.b)("h2",{id:"stunturn-gateways-for-udp-blocked-corporate-environments"},"STUN/TURN gateways for UDP-blocked corporate environments"),Object(i.b)("p",null,"Currently Kilo will fail to establish VPN connection if the endpoint is located behind a symmetric NAT/firewall.\nTo workaround this issue, (Interactive Connectivity Establishment (RFC8445)](",Object(i.b)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Interactive_Connectivity_Establishment"},"https://en.wikipedia.org/wiki/Interactive_Connectivity_Establishment"),") can be used."),Object(i.b)("p",null,Object(i.b)("a",{parentName:"p",href:"https://wiretrustee.com/"},"Wiretrustee")," is a project implementing this feature.\nWork is ongoing to integrate this code into Kilo."),Object(i.b)("p",null,"See: ",Object(i.b)("a",{parentName:"p",href:"https://github.com/squat/kilo/issues/189"},"https://github.com/squat/kilo/issues/189")),Object(i.b)("h1",{id:"further-reading"},"Further Reading"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"https://www.jordanwhited.com/posts/wireguard-endpoint-discovery-nat-traversal/"},"Jordan Whited: WireGuard Endpoint Discovery and NAT Traversal using DNS-SD")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"https://tailscale.com/blog/how-nat-traversal-works/"},"David Anderson: How NAT traversal works, Tailscale")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"https://tailscale.com/"},"Tailscale")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"https://wiretrustee.com/"},"Wiretrustee"))))}p.isMDXComponent=!0}}]);